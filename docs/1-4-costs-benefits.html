<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>climate-econ - 1.4 – how do we measure the costs and benefits of climate change?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">climate-econ</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-part-one" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">part one</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-part-one">    
        <li>
    <a class="dropdown-item" href="./1-1-what-is-climate-change.html" rel="" target="">
 <span class="dropdown-text">1.1 – what is climate change?</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./1-2-climate-and-economy.html" rel="" target="">
 <span class="dropdown-text">1.2 – how are the climate and economy linked?</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./1-3-climate-economics.html" rel="" target="">
 <span class="dropdown-text">1.3 – why is climate change an economic problem?</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./1-4-costs-benefits.html" rel="" target="">
 <span class="dropdown-text">1.4 – how do we measure the costs and benefits of climate change?</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./1-5-discounting.html" rel="" target="">
 <span class="dropdown-text">1.5 – should i care about my grandchildren’s future?</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./1-6-climate-damages.html" rel="" target="">
 <span class="dropdown-text">1.6 – can we put a price on climate impacts?</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./1-7-climate-burdens.html" rel="" target="">
 <span class="dropdown-text">1.7 – who bears the burden of climate impacts?</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-part-two" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">part two</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-part-two">    
        <li>
    <a class="dropdown-item" href="./2-1-econ-climate-solutions.html" rel="" target="">
 <span class="dropdown-text">2.1 – how would an economist solve climate change?</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools ms-auto">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#benefit-cost-analysis" id="toc-benefit-cost-analysis" class="nav-link active" data-scroll-target="#benefit-cost-analysis">benefit-cost analysis</a></li>
  <li><a href="#valuing-mortality-risk" id="toc-valuing-mortality-risk" class="nav-link" data-scroll-target="#valuing-mortality-risk">valuing mortality risk</a></li>
  <li><a href="#present-value" id="toc-present-value" class="nav-link" data-scroll-target="#present-value">present value</a></li>
  <li><a href="#benefit-cost-criterion" id="toc-benefit-cost-criterion" class="nav-link" data-scroll-target="#benefit-cost-criterion">benefit-cost criterion</a></li>
  <li><a href="#resources-and-further-reading" id="toc-resources-and-further-reading" class="nav-link" data-scroll-target="#resources-and-further-reading">resources and further reading</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">1.4 – how do we measure the costs and benefits of climate change?</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- ## key concepts
 -->
<section id="benefit-cost-analysis" class="level2">
<h2 class="anchored" data-anchor-id="benefit-cost-analysis">benefit-cost analysis</h2>
<p>Benefit-cost analysis allows us to make decisons on whether we move forward with a project. We make benefit-cost decisions every day, but for climate change, we’re usually interested the actions of a government deciding whether to move forward with a policy that affect GHG emissions. For climate change, we bear costs of reducing emissions in the short run, but the benefits we receive might play out over a longer time horizon.</p>
<p>The basic steps for conducting a benefit-cost analysis are as follows:</p>
<ol type="1">
<li>Set up the framework for analysis (define alternatives &amp; baseline, i.e., “doing nothing”)</li>
<li>Decide whose costs &amp; benefits should be recognized</li>
<li>Identify and categorize costs &amp; benefits</li>
<li>Project costs and benefits over the life of each alternative</li>
<li>Monetize costs and benefits (List benefits/costs that cannot be quantified)</li>
<li>Compute net present value of benefits and costs</li>
<li>Perform sensitivity analysis</li>
</ol>
<p>When thinking about benefits, we want to consider both impacts to market goods (e.g., climate impacts on agricultural yields) as well as non-market goods (e.g., heat-related mortality, reduced air pollution). Economists have developed several tools to monetize non-market goods. This monetization step is important because if we cannot monetize a benefit, we cannot include the value of that benefit in our benefit-cost analysis.</p>
</section>
<section id="valuing-mortality-risk" class="level2">
<h2 class="anchored" data-anchor-id="valuing-mortality-risk">valuing mortality risk</h2>
<p>Often, one of the biggest benefits of any environmental regulation is the reduction in deaths that result from environmental pollution. Climate change is no different. Climate change will increase the frequency and intensity of heat waves, tropical cyclones, drought (which can lead to crop failure and food insecurity), forest fires, and so forth. These events will increase the risk of death for people around the world. Reducing GHG emissions will reduce the risk of these events, which will reduce the risk of death. One way to value that benefit is to use the <strong>value of a statistical life (VSL)</strong> (also known as the <em>value of mortality risk reductions</em>). The VSL is the amount of money that a person is willing to pay to reduce their risk of death by a small amount. The way it is calculated is as follows. Imagine gathering 100,000 people. Then, ask each of them how much they would be willing to pay to reduce their risk of death by 1 in 100,000 that year.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> If the average person is willing to pay $100 for a reducing the risk of death by 0.001%, then multiplying that by the number of people in the group (100,000) gives us a VSL estimate of $10,000,000. This value is approximately the current value used by the US government to value mortality risk reductions (see EPA’s guidance <a href="https://www.epa.gov/environmental-economics/mortality-risk-valuation">here</a>).</p>
</section>
<section id="present-value" class="level2">
<h2 class="anchored" data-anchor-id="present-value">present value</h2>
<p>When adding up costs and benefits that accrue over time, we need to compare them on equal footing. To do that, we find the present value of future costs and benefits. The <strong>present value</strong> of a future payment is the amount of money that would need to be invested today at a given interest rate to yield that future payment.</p>
<p>We calculate the PV of a single value in the future using the following formula:</p>
<p><span class="math display">\[PV(b) = \frac{b}{(1 + r)^t}\]</span></p>
<p>where <span class="math inline">\(b\)</span> is the future value of the payment, <span class="math inline">\(r\)</span> is the discount rate, and <span class="math inline">\(t\)</span> is the number of years until the payment is received. The higher the discount rate, the lower the present value of money in the future.</p>
<p>We can also calculate the PV of a stream of future benefits using the following formula:</p>
<p><span class="math display">\[PV(b_t) = \sum_{t=1}^T \frac{b_t}{(1 + r)^t}\]</span></p>
<p>where <span class="math inline">\(b_t\)</span> is the amount of benefits received in each year <span class="math inline">\(t\)</span> and <span class="math inline">\(T\)</span> is the total number of years over which benefits are received. This is the same as the single period formula, but we repeat that formula for each year benefits accrue.</p>
<p>Note, you can also calculate the PV of a stream of future costs using a “continuous time” version of the formula:</p>
<p><span class="math display">\[PV(b_t) = b_t \exp(-rt)\]</span></p>
<p>The basic idea behind discounting is that we are impatient. We would prefer to receive money now, rather than in the future. So, we discount future benefits and costs to reflect our degree of impatience. This idea stems from the fact that we can earn interest on money today. With a 5% interest rate, we should be indifferent between $100 today and $105 a year from now, because we could invest that $100 and earn $5 of interest payments in one year. Discounting just reverses that same idea. Nominal dollar amounts received in the future will be worth less than nominal dollar amounts received today. This is especially important with climate change because many of the benefits of climate change mitigation will occur very far in the future, while the costs will be borne today.</p>
</section>
<section id="benefit-cost-criterion" class="level2">
<h2 class="anchored" data-anchor-id="benefit-cost-criterion">benefit-cost criterion</h2>
<p>When deciding whether to move forward with a project, or choose among alternative projects, we want to make sure that the benefits are at least as great as the costs (or choose the project with the highest benefit-cost ratio). The benefit-cost criterion that we will adopt is called the <strong>potential Pareto Improvment (PPI)</strong> or <strong>Kaldor-Hicks criterion</strong>, which states that the benefits that accrue to the “winners” need to be large enough such that the “losers” could be compensated, even if that compensation never actually occurs.</p>
</section>
<section id="resources-and-further-reading" class="level2">
<h2 class="anchored" data-anchor-id="resources-and-further-reading">resources and further reading</h2>
<ul>
<li><a href="https://www.epa.gov/environmental-economics/guidelines-preparing-economic-analyses">EPA’s guidelines for preparing benefit-cost analysis</a></li>
<li><a href="https://www.epa.gov/environmental-economics/mortality-risk-valuation">EPA’s guidelines for valuing mortality risk reductions</a></li>
</ul>
<!-- 
To do:
-- add a section explicitly distinguishing between market and non-market goods
-- add a section on expected PV
 -->


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Note that 1 in 100,000 is approximately the risk of death from a general anasthetic.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>