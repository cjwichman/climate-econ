<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>climate-econ - 1.5 – should i care about my grandchildren’s future?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">climate-econ</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-part-one" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">part one</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-part-one">    
        <li>
    <a class="dropdown-item" href="./1-1-what-is-climate-change.html" rel="" target="">
 <span class="dropdown-text">1.1 – what is climate change?</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./1-2-climate-and-economy.html" rel="" target="">
 <span class="dropdown-text">1.2 – how are the climate and economy linked?</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./1-3-climate-economics.html" rel="" target="">
 <span class="dropdown-text">1.3 – why is climate change an economic problem?</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./1-4-costs-benefits.html" rel="" target="">
 <span class="dropdown-text">1.4 – what are the costs and benefits of climate change</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./1-5-discounting.html" rel="" target="">
 <span class="dropdown-text">1.5 – should i care about my grandchildren’s future?</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./1-6-climate-damages.html" rel="" target="">
 <span class="dropdown-text">1.6 – can we put a price on climate impacts?</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./1-7-climate-burdens.html" rel="" target="">
 <span class="dropdown-text">1.7 – who bears the burden of climate impacts?</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-part-two" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">part two</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-part-two">    
        <li>
    <a class="dropdown-item" href="./2-1-econ-climate-solutions.html" rel="" target="">
 <span class="dropdown-text">2.1 – how would an economist solve climate change?</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools ms-auto">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#discounting" id="toc-discounting" class="nav-link active" data-scroll-target="#discounting">discounting</a></li>
  <li><a href="#the-social-discount-rate" id="toc-the-social-discount-rate" class="nav-link" data-scroll-target="#the-social-discount-rate">the social discount rate</a></li>
  <li><a href="#what-social-discount-rate-should-we-use" id="toc-what-social-discount-rate-should-we-use" class="nav-link" data-scroll-target="#what-social-discount-rate-should-we-use">what social discount rate should we use?</a></li>
  <li><a href="#uncertainty-and-the-discount-rate" id="toc-uncertainty-and-the-discount-rate" class="nav-link" data-scroll-target="#uncertainty-and-the-discount-rate">uncertainty and the discount rate</a></li>
  <li><a href="#importance-of-the-discount-rate" id="toc-importance-of-the-discount-rate" class="nav-link" data-scroll-target="#importance-of-the-discount-rate">importance of the discount rate</a></li>
  <li><a href="#resources-and-further-reading" id="toc-resources-and-further-reading" class="nav-link" data-scroll-target="#resources-and-further-reading">resources and further reading</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">1.5 – should i care about my grandchildren’s future?</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- ## key concepts
 -->
<section id="discounting" class="level2">
<h2 class="anchored" data-anchor-id="discounting">discounting</h2>
<p>One of the fundamental challenges of valuing climate impacts is that the benefits of GHG mitigation accrue over centuries. Some of those benefits will be enjoyed by the current generation, while others will be enjoyed by future generations. How should we value benefits to future generations?</p>
<p>There are two primary approaches to valuing benefits to future generations:</p>
<ul>
<li><p>The <strong>descriptive approach</strong> states that We should invest resources according real market rates of return. Taking $50M and investing in climate mitigation might earn very little or no return. Investing that same $50M in financial markets might earn 3-10% returns per year. Therefore, discount rates should be determined by the opportunity cost of capital investments.</p></li>
<li><p>The <strong>prescriptive approach</strong> states that it is unethical to “discount” the welfare of future generations, so we should use a very low discount rate (e.g., 1% or even 0%). It is important to distinguish discount rates on goods vs.&nbsp;discount rates on welfare of future generations. Future generations will (very likely) be wealthier than us, so we might want to value consumption in our relatively poor generation more heavily than consumption in the future (even if we value future generations’ welfare equally)</p></li>
</ul>
</section>
<section id="the-social-discount-rate" class="level2">
<h2 class="anchored" data-anchor-id="the-social-discount-rate">the social discount rate</h2>
<p>The <strong>social discount rate</strong> is the rate at which society discounts future benefits and costs. One useful tool for thinking about the social discount rate is the <strong>Ramsey equation</strong>. The Ramsey equaion is defined as follows:</p>
<p><span class="math display">\[ r = \delta + \eta g\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(r\)</span> is the social discount rate</li>
<li><span class="math inline">\(\delta\)</span> is the <strong>pure rate of time preference</strong> (e.g., our degree of impatience)
<ul>
<li>This term governs how consumers discount utility over time. Higher <span class="math inline">\(\delta\)</span> raises marginal benefit of consuming now. Think of this as impatience.</li>
<li>If you weight future generations’ welfare the same as today, you’d set <span class="math inline">\(\delta = 0\)</span>.</li>
<li>Reasonable values of <span class="math inline">\(\delta\)</span> typically fall between 0% and 2%.</li>
</ul></li>
<li><span class="math inline">\(\eta\)</span> is the <strong>elasticity of marginal utility of consumption</strong>
<ul>
<li>A.K.A.: the <em>coefficient of relative risk aversion</em> or <em>intergenerational inequality aversion</em></li>
<li>Governs how much we value an additional dollar as society grows wealthier. As <span class="math inline">\(\eta\)</span> increases, the more we dislike inequality, which means we value today’s consumption more strongly.</li>
<li>Reasonable values of <span class="math inline">\(\eta\)</span> typically fall between 1 and 4.</li>
</ul></li>
<li><span class="math inline">\(g\)</span> is the expected growth rate of consumption per capita
<ul>
<li>Long-run economic growth rates typically fall between 1% and 3% per year.</li>
</ul></li>
</ul>
</section>
<section id="what-social-discount-rate-should-we-use" class="level2">
<h2 class="anchored" data-anchor-id="what-social-discount-rate-should-we-use">what social discount rate should we use?</h2>
<p>Choosing a value for the social discount rate is a tricky business that can be informed just as much by ethics and philosophy as it can by economics.</p>
<ul>
<li><p>The federal government typically uses two discount rates for benefit-cost analysis: 3% and 7%. The 3% rate is used to reflect the opportunity cost of consumption, while the 7% rate is used to reflect the opportunity cost of capital investment.</p></li>
<li><p>Alternative rationales depend on moral or ethical considerations in choosing the parameters for the Ramsey equation. The 2007 <a href="https://webarchive.nationalarchives.gov.uk/ukgwa/20100407172811/https:/www.hm-treasury.gov.uk/stern_review_report.htm">Stern Review on the Economics of Climate Change</a> used a social discount rate of 1.4%. These choices were made to reflect the following:</p>
<ul>
<li><span class="math inline">\(\delta=0.1\%\)</span> reflects the idea that we should value future generations’ welfare almost equally to our own.</li>
<li><span class="math inline">\(\eta=1\)</span> reflects the idea that we should value an additional dollar of consumption equally, regardless of how wealthy we are.</li>
<li><span class="math inline">\(g=1.3\%\)</span> reflects the idea that we expect consumption per capita to grow at 1.3% per year.</li>
</ul></li>
<li><p>The choice of <span class="math inline">\(\eta=1\)</span> was particularly conversial. Many economists believe that <span class="math inline">\(\eta\)</span> should be larger than 1, which would imply that we should value an additional dollar of consumption more highly as we become wealthier. This would imply that we should use a higher discount rate.</p></li>
</ul>
</section>
<section id="uncertainty-and-the-discount-rate" class="level2">
<h2 class="anchored" data-anchor-id="uncertainty-and-the-discount-rate">uncertainty and the discount rate</h2>
<p>Projecting future costs and benefits is inherently uncertain. When using the Ramsey equation, we need to make assumptions about the growth rate of consumption per capita over centuries. When focused on a descriptive approach, the discount rate might reflect changes in interests rates that may be driven by uncertain future monetary policy.</p>
<ul>
<li>Uncertainty in the discount rate provides justification for using a <em>lower</em> discount rate.</li>
</ul>
</section>
<section id="importance-of-the-discount-rate" class="level2">
<h2 class="anchored" data-anchor-id="importance-of-the-discount-rate">importance of the discount rate</h2>
<p>The choice of the social discount rate is one of the most influential components for understanding the costs and benefits of climate change. Because discounting compounds values over time, and GHG mitigation generates benefits over a long time horizon, small changes in the discount rate can have large impacts on the present value of future benefits.</p>
<p>Imagine receiving a benefit of $1 million in 100 years.</p>
<ul>
<li>At a 2% discount rate, the PV of that benefit is ~$138,000.</li>
<li>At a 3% discount rate, the PV of that benefit is ~$52,000.</li>
<li>At a 7% discount rate, the PV of that benefit is ~$1150.</li>
</ul>
<p>If the cost of achieving that benefit were $100,000 today, it is easy to see how the project makes sense at a 2% discount rate, but not at a 3% or 7% discount rate.</p>
</section>
<section id="resources-and-further-reading" class="level2">
<h2 class="anchored" data-anchor-id="resources-and-further-reading">resources and further reading</h2>
<ul>
<li>Arrow et al., 2003. <a href="https://www.science.org/doi/10.1126/science.1235665">“Determining Benefits and Costs for Future Generations”</a>, <em>Science</em>.</li>
</ul>
<!-- 
To do:
-- Add a shiny app that shows how the discount rate affects the present value of future benefits. Maybe goes in BCA chapter?
-- Show certainty-equivalent discount rates
 -->


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>